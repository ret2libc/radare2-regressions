#!/bin/sh
for a in . .. ../.. ; do [ -e $a/tests.sh ] && . $a/tests.sh && break ; done

NAME='elf_stripped'
FILE=../../bins/elf/elf_stripped
CMDS='is;ir;iS
'
EXPECT='[Symbols]
004 0x000004ac 0x080484ac GLOBAL OBJECT    4 _IO_stdin_used
001 0x000002d0 0x080482d0 GLOBAL   FUNC   16 imp.puts
002 0x000002e0 0x080482e0   WEAK NOTYPE   16 imp.__gmon_start__
003 0x000002f0 0x080482f0 GLOBAL   FUNC   16 imp.__libc_start_main
[Relocations]
vaddr=0x08049690 paddr=0x00000690 type=SET_32 __gmon_start__
vaddr=0x080496a0 paddr=0x000006a0 type=SET_32 puts
vaddr=0x080496a4 paddr=0x000006a4 type=SET_32 __gmon_start__
vaddr=0x080496a8 paddr=0x000006a8 type=SET_32 __libc_start_main

4 relocations
[Sections]
00 0x00000270     8 0x08048270     8 ----- .rel.dyn
01 0x00000278    24 0x08048278    24 ----- .rela.plt
02 0x00000694    24 0x08049694    24 ----- .got.plt
03 0x00000034   256 0x08048034   256 m-r-x PHDR
04 0x00000134    19 0x08048134    19 m-r-- INTERP
05 0x00000000  1436 0x08048000  1436 m-r-x LOAD0
06 0x0000059c   280 0x0804959c   284 m-rw- LOAD1
07 0x000005a8   232 0x080495a8   232 m-rw- DYNAMIC
08 0x00000148    68 0x08048148    68 m-r-- NOTE
09 0x000004c0    44 0x080484c0    44 m-r-- GNU_EH_FRAME
10 0x00000000     0 0x00000000     0 m-rw- GNU_STACK
11 0x00000000    52 0x08048000    52 m-rw- ehdr
'
run_test



NAME='elf_one_symbol_shdr'
FILE=../../bins/elf/elf_one_symbol_shdr
CMDS='is;ir;iS
'
EXPECT='[Symbols]
004 0x000004ac 0x080484ac GLOBAL OBJECT    4 _IO_stdin_used
001 0x000002d0 0x080482d0 GLOBAL   FUNC   16 imp.puts
002 0x000002e0 0x080482e0   WEAK NOTYPE   16 imp.__gmon_start__
003 0x000002f0 0x080482f0 GLOBAL   FUNC   16 imp.__libc_start_main
[Relocations]
vaddr=0x08049690 paddr=0x00000690 type=SET_32 __gmon_start__
vaddr=0x080496a0 paddr=0x000006a0 type=SET_32 puts
vaddr=0x080496a4 paddr=0x000006a4 type=SET_32 __gmon_start__
vaddr=0x080496a8 paddr=0x000006a8 type=SET_32 __libc_start_main

4 relocations
[Sections]
00 0x00000000     0 0x00000000     0 ----- 
01 0x00000134    19 0x08048134    19 --r-- .interp
02 0x00000148    32 0x08048148    32 --r-- .note.ABI_tag
03 0x00000168    36 0x08048168    36 --r-- .note.gnu.build_id
04 0x0000018c    32 0x0804818c    32 --r-- .gnu.hash
05 0x000001ac    16 0x080481ac    16 --r-- .dynsym
06 0x000001fc    74 0x080481fc    74 --r-- .dynstr
07 0x00000246    10 0x08048246    10 --r-- .gnu.version
08 0x00000250    32 0x08048250    32 --r-- .gnu.version_r
09 0x00000270     8 0x08048270     8 --r-- .rel.dyn
10 0x00000278    24 0x08048278    24 --r-- .rel.plt
11 0x00000290    35 0x08048290    35 --r-x .init
12 0x000002c0    64 0x080482c0    64 --r-x .plt
13 0x00000300   404 0x08048300   404 --r-x .text
14 0x00000494    20 0x08048494    20 --r-x .fini
15 0x000004a8    21 0x080484a8    21 --r-- .rodata
16 0x000004c0    44 0x080484c0    44 --r-- .eh_frame_hdr
17 0x000004ec   176 0x080484ec   176 --r-- .eh_frame
18 0x0000059c     4 0x0804959c     4 --rw- .init_array
19 0x000005a0     4 0x080495a0     4 --rw- .fini_array
20 0x000005a4     4 0x080495a4     4 --rw- .jcr
21 0x000005a8   232 0x080495a8   232 --rw- .dynamic
22 0x00000690     4 0x08049690     4 --rw- .got
23 0x00000694    24 0x08049694    24 --rw- .got.plt
24 0x000006ac     8 0x080496ac     8 --rw- .data
25 0x000006b4     0 0x080496b4     4 --rw- .bss
26 0x000006b4    17 0x00000000    17 ----- .comment
27 0x000006c5   262 0x00000000   262 ----- .shstrtab
28 0x00000c7c    16 0x00000000    16 ----- .symtab
29 0x000010cc   599 0x00000000   599 ----- .strtab
30 0x00000034   256 0x08048034   256 m-r-x PHDR
31 0x00000134    19 0x08048134    19 m-r-- INTERP
32 0x00000000  1436 0x08048000  1436 m-r-x LOAD0
33 0x0000059c   280 0x0804959c   284 m-rw- LOAD1
34 0x000005a8   232 0x080495a8   232 m-rw- DYNAMIC
35 0x00000148    68 0x08048148    68 m-r-- NOTE
36 0x000004c0    44 0x080484c0    44 m-r-- GNU_EH_FRAME
37 0x00000000     0 0x00000000     0 m-rw- GNU_STACK
38 0x00000000    52 0x08048000    52 m-rw- ehdr
'
run_test



NAME='elf_overlapped'
FILE=../../bins/elf/analysis/elf_overlapped
CMDS='is;s 0x00400508; pi 1
'
EXPECT='[Symbols]
001 0x00000200 0x00400200  LOCAL SECTION    0 
002 0x0000021c 0x0040021c  LOCAL SECTION    0 
003 0x0000023c 0x0040023c  LOCAL SECTION    0 
004 0x00000260 0x00400260  LOCAL SECTION    0 
005 0x00000280 0x00400280  LOCAL SECTION    0 
006 0x000002e0 0x004002e0  LOCAL SECTION    0 
007 0x00000320 0x00400320  LOCAL SECTION    0 
008 0x00000328 0x00400328  LOCAL SECTION    0 
009 0x00000348 0x00400348  LOCAL SECTION    0 
010 0x00000360 0x00400360  LOCAL SECTION    0 
011 0x00000390 0x00400390  LOCAL SECTION    0 
012 0x000003b0 0x004003b0  LOCAL SECTION    0 
013 0x000003e0 0x004003e0  LOCAL SECTION    0 
014 0x000003f0 0x004003f0  LOCAL SECTION    0 
015 0x00000594 0x00400594  LOCAL SECTION    0 
016 0x000005a0 0x004005a0  LOCAL SECTION    0 
017 0x000005a4 0x004005a4  LOCAL SECTION    0 
018 0x000005d8 0x004005d8  LOCAL SECTION    0 
019 0x000016d0 0x006006d0  LOCAL SECTION    0 
020 0x000016d8 0x006006d8  LOCAL SECTION    0 
021 0x000016e0 0x006006e0  LOCAL SECTION    0 
022 0x000016e8 0x006006e8  LOCAL SECTION    0 
023 0x000018b8 0x006008b8  LOCAL SECTION    0 
024 0x000018c0 0x006008c0  LOCAL SECTION    0 
025 0x000018e8 0x006008e8  LOCAL SECTION    0 
026 0x000018f8 0x006008f8  LOCAL SECTION    0 
027 0x00000000 0x00400000  LOCAL SECTION    0 
028 0x00000000 0x00400000  LOCAL   FILE    0 init.c
029 0x00000000 0x00400000  LOCAL   FILE    0 crtstuff.c
030 0x000016e0 0x006006e0  LOCAL OBJECT    0 __JCR_LIST__
031 0x00000420 0x00400420  LOCAL   FUNC    0 deregister_tm_clones
032 0x00000460 0x00400460  LOCAL   FUNC    0 register_tm_clones
033 0x000004a0 0x004004a0  LOCAL   FUNC    0 __do_global_dtors_aux
034 0x000018f8 0x006008f8  LOCAL OBJECT    1 completed.6938
035 0x000016d8 0x006006d8  LOCAL OBJECT    0 __do_global_dtors_aux_fini_array_entry
036 0x000004c0 0x004004c0  LOCAL   FUNC    0 frame_dummy
037 0x000016d0 0x006006d0  LOCAL OBJECT    0 __frame_dummy_init_array_entry
038 0x00000000 0x00400000  LOCAL   FILE    0 a.c
039 0x00000000 0x00400000  LOCAL   FILE    0 crtstuff.c
040 0x000006c8 0x004006c8  LOCAL OBJECT    0 __FRAME_END__
041 0x000016e0 0x006006e0  LOCAL OBJECT    0 __JCR_END__
042 0x00000000 0x00400000  LOCAL   FILE    0 
043 0x000016d8 0x006006d8  LOCAL NOTYPE    0 __init_array_end
044 0x000016e8 0x006006e8  LOCAL OBJECT    0 _DYNAMIC
045 0x000016d0 0x006006d0  LOCAL NOTYPE    0 __init_array_start
046 0x000005a4 0x004005a4  LOCAL NOTYPE    0 __GNU_EH_FRAME_HDR
047 0x000018c0 0x006008c0  LOCAL OBJECT    0 _GLOBAL_OFFSET_TABLE_
048 0x00000590 0x00400590 GLOBAL   FUNC    2 __libc_csu_fini
050 0x000018e8 0x006008e8   WEAK NOTYPE    0 data_start
051 0x000018f8 0x006008f8 GLOBAL NOTYPE    0 _edata
052 0x00000594 0x00400594 GLOBAL   FUNC    0 _fini
055 0x000018e8 0x006008e8 GLOBAL NOTYPE    0 __data_start
057 0x000018f0 0x006008f0 GLOBAL OBJECT    0 __dso_handle
058 0x000005a0 0x004005a0 GLOBAL OBJECT    4 _IO_stdin_used
059 0x00000520 0x00400520 GLOBAL   FUNC  101 __libc_csu_init
060 0x00600900 0x00600900 GLOBAL NOTYPE    0 _end
061 0x000003f0 0x004003f0 GLOBAL   FUNC   42 _start
062 0x000018f8 0x006008f8 GLOBAL NOTYPE    0 __bss_start
063 0x000004e6 0x004004e6 GLOBAL   FUNC   46 main
065 0x000018f8 0x006008f8 GLOBAL OBJECT    0 __TMC_END__
067 0x00000390 0x00400390 GLOBAL   FUNC    0 _init
001 0x000003c0 0x004003c0 GLOBAL   FUNC   16 imp.system
002 0x000003d0 0x004003d0 GLOBAL   FUNC   16 imp.__libc_start_main
003 0x00000000 0x00400000   WEAK NOTYPE   16 imp.__gmon_start__
003 0x00000000 0x00400000   WEAK NOTYPE   16 imp.__gmon_start__
call sym.imp.system
'
run_test

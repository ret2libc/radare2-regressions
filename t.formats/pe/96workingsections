#!/bin/sh
for a in . .. ../.. ; do [ -e $a/tests.sh ] && . $a/tests.sh ; done

NAME='PE: corkami 96workingsections.exe - open and analyze'
FILE=../../bins/pe/96workingsections.exe
ARGS='-A'
CMDS="q!"
EXPECT=''
IGNORE_ERR=1
run_test

NAME='PE: corkami 96workingsections.exe - entrypoint'
FILE=../../bins/pe/96workingsections.exe
CMDS='
s
'
EXPECT='0x461000
'
IGNORE_ERR=1
run_test

NAME='PE: corkami 96workingsections.exe - pi 1'
FILE=../../bins/pe/96workingsections.exe
CMDS='
pi 1
'
EXPECT='jmp 0x461001
'
IGNORE_ERR=1
run_test

NAME='PE: corkami 96workingsections.exe - section list'
FILE=../../bins/pe/96workingsections.exe
ARGS='-n'
CMDS="!rabin2 -S ${FILE}"
EXPECT='[Sections]
00 0x00001200   512 0x00402000  4096 -rwx sect_0
01 0x00001400   512 0x00403000  4096 -rwx sect_1
02 0x00001600   512 0x00404000  4096 -rwx sect_2
03 0x00001800   512 0x00405000  4096 -rwx sect_3
04 0x00001a00   512 0x00406000  4096 -rwx sect_4
05 0x00001c00   512 0x00407000  4096 -rwx sect_5
06 0x00001e00   512 0x00408000  4096 -rwx sect_6
07 0x00002000   512 0x00409000  4096 -rwx sect_7
08 0x00002200   512 0x0040a000  4096 -rwx sect_8
09 0x00002400   512 0x0040b000  4096 -rwx sect_9
10 0x00002600   512 0x0040c000  4096 -rwx sect_10
11 0x00002800   512 0x0040d000  4096 -rwx sect_11
12 0x00002a00   512 0x0040e000  4096 -rwx sect_12
13 0x00002c00   512 0x0040f000  4096 -rwx sect_13
14 0x00002e00   512 0x00410000  4096 -rwx sect_14
15 0x00003000   512 0x00411000  4096 -rwx sect_15
16 0x00003200   512 0x00412000  4096 -rwx sect_16
17 0x00003400   512 0x00413000  4096 -rwx sect_17
18 0x00003600   512 0x00414000  4096 -rwx sect_18
19 0x00003800   512 0x00415000  4096 -rwx sect_19
20 0x00003a00   512 0x00416000  4096 -rwx sect_20
21 0x00003c00   512 0x00417000  4096 -rwx sect_21
22 0x00003e00   512 0x00418000  4096 -rwx sect_22
23 0x00004000   512 0x00419000  4096 -rwx sect_23
24 0x00004200   512 0x0041a000  4096 -rwx sect_24
25 0x00004400   512 0x0041b000  4096 -rwx sect_25
26 0x00004600   512 0x0041c000  4096 -rwx sect_26
27 0x00004800   512 0x0041d000  4096 -rwx sect_27
28 0x00004a00   512 0x0041e000  4096 -rwx sect_28
29 0x00004c00   512 0x0041f000  4096 -rwx sect_29
30 0x00004e00   512 0x00420000  4096 -rwx sect_30
31 0x00005000   512 0x00421000  4096 -rwx sect_31
32 0x00005200   512 0x00422000  4096 -rwx sect_32
33 0x00005400   512 0x00423000  4096 -rwx sect_33
34 0x00005600   512 0x00424000  4096 -rwx sect_34
35 0x00005800   512 0x00425000  4096 -rwx sect_35
36 0x00005a00   512 0x00426000  4096 -rwx sect_36
37 0x00005c00   512 0x00427000  4096 -rwx sect_37
38 0x00005e00   512 0x00428000  4096 -rwx sect_38
39 0x00006000   512 0x00429000  4096 -rwx sect_39
40 0x00006200   512 0x0042a000  4096 -rwx sect_40
41 0x00006400   512 0x0042b000  4096 -rwx sect_41
42 0x00006600   512 0x0042c000  4096 -rwx sect_42
43 0x00006800   512 0x0042d000  4096 -rwx sect_43
44 0x00006a00   512 0x0042e000  4096 -rwx sect_44
45 0x00006c00   512 0x0042f000  4096 -rwx sect_45
46 0x00006e00   512 0x00430000  4096 -rwx sect_46
47 0x00007000   512 0x00431000  4096 -rwx sect_47
48 0x00007200   512 0x00432000  4096 -rwx sect_48
49 0x00007400   512 0x00433000  4096 -rwx sect_49
50 0x00007600   512 0x00434000  4096 -rwx sect_50
51 0x00007800   512 0x00435000  4096 -rwx sect_51
52 0x00007a00   512 0x00436000  4096 -rwx sect_52
53 0x00007c00   512 0x00437000  4096 -rwx sect_53
54 0x00007e00   512 0x00438000  4096 -rwx sect_54
55 0x00008000   512 0x00439000  4096 -rwx sect_55
56 0x00008200   512 0x0043a000  4096 -rwx sect_56
57 0x00008400   512 0x0043b000  4096 -rwx sect_57
58 0x00008600   512 0x0043c000  4096 -rwx sect_58
59 0x00008800   512 0x0043d000  4096 -rwx sect_59
60 0x00008a00   512 0x0043e000  4096 -rwx sect_60
61 0x00008c00   512 0x0043f000  4096 -rwx sect_61
62 0x00008e00   512 0x00440000  4096 -rwx sect_62
63 0x00009000   512 0x00441000  4096 -rwx sect_63
64 0x00009200   512 0x00442000  4096 -rwx sect_64
65 0x00009400   512 0x00443000  4096 -rwx sect_65
66 0x00009600   512 0x00444000  4096 -rwx sect_66
67 0x00009800   512 0x00445000  4096 -rwx sect_67
68 0x00009a00   512 0x00446000  4096 -rwx sect_68
69 0x00009c00   512 0x00447000  4096 -rwx sect_69
70 0x00009e00   512 0x00448000  4096 -rwx sect_70
71 0x0000a000   512 0x00449000  4096 -rwx sect_71
72 0x0000a200   512 0x0044a000  4096 -rwx sect_72
73 0x0000a400   512 0x0044b000  4096 -rwx sect_73
74 0x0000a600   512 0x0044c000  4096 -rwx sect_74
75 0x0000a800   512 0x0044d000  4096 -rwx sect_75
76 0x0000aa00   512 0x0044e000  4096 -rwx sect_76
77 0x0000ac00   512 0x0044f000  4096 -rwx sect_77
78 0x0000ae00   512 0x00450000  4096 -rwx sect_78
79 0x0000b000   512 0x00451000  4096 -rwx sect_79
80 0x0000b200   512 0x00452000  4096 -rwx sect_80
81 0x0000b400   512 0x00453000  4096 -rwx sect_81
82 0x0000b600   512 0x00454000  4096 -rwx sect_82
83 0x0000b800   512 0x00455000  4096 -rwx sect_83
84 0x0000ba00   512 0x00456000  4096 -rwx sect_84
85 0x0000bc00   512 0x00457000  4096 -rwx sect_85
86 0x0000be00   512 0x00458000  4096 -rwx sect_86
87 0x0000c000   512 0x00459000  4096 -rwx sect_87
88 0x0000c200   512 0x0045a000  4096 -rwx sect_88
89 0x0000c400   512 0x0045b000  4096 -rwx sect_89
90 0x0000c600   512 0x0045c000  4096 -rwx sect_90
91 0x0000c800   512 0x0045d000  4096 -rwx sect_91
92 0x0000ca00   512 0x0045e000  4096 -rwx sect_92
93 0x0000cc00   512 0x0045f000  4096 -rwx sect_93
94 0x0000ce00   512 0x00460000  4096 -rwx sect_94
95 0x0000d000   512 0x00461000  4096 -rwx sect_95
'
IGNORE_ERR=1
run_test


NAME='PE: corkami 96workingsections.exe - section list - unfiltered'
FILE=../../bins/pe/96workingsections.exe
ARGS='-n'
CMDS="!rabin2 -uS ${FILE}"
EXPECT='[Sections]
00 0x00001200   512 0x00402000  4096 -rwx sect_0
01 0x00001400   512 0x00403000  4096 -rwx sect_1
02 0x00001600   512 0x00404000  4096 -rwx sect_2
03 0x00001800   512 0x00405000  4096 -rwx sect_3
04 0x00001a00   512 0x00406000  4096 -rwx sect_4
05 0x00001c00   512 0x00407000  4096 -rwx sect_5
06 0x00001e00   512 0x00408000  4096 -rwx sect_6
07 0x00002000   512 0x00409000  4096 -rwx sect_7
08 0x00002200   512 0x0040a000  4096 -rwx sect_8
09 0x00002400   512 0x0040b000  4096 -rwx sect_9
10 0x00002600   512 0x0040c000  4096 -rwx sect_10
11 0x00002800   512 0x0040d000  4096 -rwx sect_11
12 0x00002a00   512 0x0040e000  4096 -rwx sect_12
13 0x00002c00   512 0x0040f000  4096 -rwx sect_13
14 0x00002e00   512 0x00410000  4096 -rwx sect_14
15 0x00003000   512 0x00411000  4096 -rwx sect_15
16 0x00003200   512 0x00412000  4096 -rwx sect_16
17 0x00003400   512 0x00413000  4096 -rwx sect_17
18 0x00003600   512 0x00414000  4096 -rwx sect_18
19 0x00003800   512 0x00415000  4096 -rwx sect_19
20 0x00003a00   512 0x00416000  4096 -rwx sect_20
21 0x00003c00   512 0x00417000  4096 -rwx sect_21
22 0x00003e00   512 0x00418000  4096 -rwx sect_22
23 0x00004000   512 0x00419000  4096 -rwx sect_23
24 0x00004200   512 0x0041a000  4096 -rwx sect_24
25 0x00004400   512 0x0041b000  4096 -rwx sect_25
26 0x00004600   512 0x0041c000  4096 -rwx sect_26
27 0x00004800   512 0x0041d000  4096 -rwx sect_27
28 0x00004a00   512 0x0041e000  4096 -rwx sect_28
29 0x00004c00   512 0x0041f000  4096 -rwx sect_29
30 0x00004e00   512 0x00420000  4096 -rwx sect_30
31 0x00005000   512 0x00421000  4096 -rwx sect_31
32 0x00005200   512 0x00422000  4096 -rwx sect_32
33 0x00005400   512 0x00423000  4096 -rwx sect_33
34 0x00005600   512 0x00424000  4096 -rwx sect_34
35 0x00005800   512 0x00425000  4096 -rwx sect_35
36 0x00005a00   512 0x00426000  4096 -rwx sect_36
37 0x00005c00   512 0x00427000  4096 -rwx sect_37
38 0x00005e00   512 0x00428000  4096 -rwx sect_38
39 0x00006000   512 0x00429000  4096 -rwx sect_39
40 0x00006200   512 0x0042a000  4096 -rwx sect_40
41 0x00006400   512 0x0042b000  4096 -rwx sect_41
42 0x00006600   512 0x0042c000  4096 -rwx sect_42
43 0x00006800   512 0x0042d000  4096 -rwx sect_43
44 0x00006a00   512 0x0042e000  4096 -rwx sect_44
45 0x00006c00   512 0x0042f000  4096 -rwx sect_45
46 0x00006e00   512 0x00430000  4096 -rwx sect_46
47 0x00007000   512 0x00431000  4096 -rwx sect_47
48 0x00007200   512 0x00432000  4096 -rwx sect_48
49 0x00007400   512 0x00433000  4096 -rwx sect_49
50 0x00007600   512 0x00434000  4096 -rwx sect_50
51 0x00007800   512 0x00435000  4096 -rwx sect_51
52 0x00007a00   512 0x00436000  4096 -rwx sect_52
53 0x00007c00   512 0x00437000  4096 -rwx sect_53
54 0x00007e00   512 0x00438000  4096 -rwx sect_54
55 0x00008000   512 0x00439000  4096 -rwx sect_55
56 0x00008200   512 0x0043a000  4096 -rwx sect_56
57 0x00008400   512 0x0043b000  4096 -rwx sect_57
58 0x00008600   512 0x0043c000  4096 -rwx sect_58
59 0x00008800   512 0x0043d000  4096 -rwx sect_59
60 0x00008a00   512 0x0043e000  4096 -rwx sect_60
61 0x00008c00   512 0x0043f000  4096 -rwx sect_61
62 0x00008e00   512 0x00440000  4096 -rwx sect_62
63 0x00009000   512 0x00441000  4096 -rwx sect_63
64 0x00009200   512 0x00442000  4096 -rwx sect_64
65 0x00009400   512 0x00443000  4096 -rwx sect_65
66 0x00009600   512 0x00444000  4096 -rwx sect_66
67 0x00009800   512 0x00445000  4096 -rwx sect_67
68 0x00009a00   512 0x00446000  4096 -rwx sect_68
69 0x00009c00   512 0x00447000  4096 -rwx sect_69
70 0x00009e00   512 0x00448000  4096 -rwx sect_70
71 0x0000a000   512 0x00449000  4096 -rwx sect_71
72 0x0000a200   512 0x0044a000  4096 -rwx sect_72
73 0x0000a400   512 0x0044b000  4096 -rwx sect_73
74 0x0000a600   512 0x0044c000  4096 -rwx sect_74
75 0x0000a800   512 0x0044d000  4096 -rwx sect_75
76 0x0000aa00   512 0x0044e000  4096 -rwx sect_76
77 0x0000ac00   512 0x0044f000  4096 -rwx sect_77
78 0x0000ae00   512 0x00450000  4096 -rwx sect_78
79 0x0000b000   512 0x00451000  4096 -rwx sect_79
80 0x0000b200   512 0x00452000  4096 -rwx sect_80
81 0x0000b400   512 0x00453000  4096 -rwx sect_81
82 0x0000b600   512 0x00454000  4096 -rwx sect_82
83 0x0000b800   512 0x00455000  4096 -rwx sect_83
84 0x0000ba00   512 0x00456000  4096 -rwx sect_84
85 0x0000bc00   512 0x00457000  4096 -rwx sect_85
86 0x0000be00   512 0x00458000  4096 -rwx sect_86
87 0x0000c000   512 0x00459000  4096 -rwx sect_87
88 0x0000c200   512 0x0045a000  4096 -rwx sect_88
89 0x0000c400   512 0x0045b000  4096 -rwx sect_89
90 0x0000c600   512 0x0045c000  4096 -rwx sect_90
91 0x0000c800   512 0x0045d000  4096 -rwx sect_91
92 0x0000ca00   512 0x0045e000  4096 -rwx sect_92
93 0x0000cc00   512 0x0045f000  4096 -rwx sect_93
94 0x0000ce00   512 0x00460000  4096 -rwx sect_94
95 0x0000d000   512 0x00461000  4096 -rwx sect_95
'
IGNORE_ERR=1
run_test
